---
layout: post
title: "Performance Testing Guidance for Web Applications"
---
<br/>

이 글은 Microsoft의 Performance Testing Guidance for Web Applications 에 대한 글로, **직역과 오역이 다분히 많고, 저의 개인적인 생각을 추가하여 정리한 글** 임을 서두에 밝힙니다.

## Part 1 - Introduction to Performance Testing

### Chapter 1 - Fundamentals of Web Application Performance Testing
 - 성능 테스팅이란 어플리케이션 서비스의 반응성, 처리량, 신뢰성 그리고 규모에 대한 확장성 등을 검증하기 위한 방법이다.

##### 성능 테스팅의 과정
- 테스트 환경의 확인: 하드웨어, 소프트웨어, 네트워크 등의 환경을 확인하고 설정하는 과정
- 테스트 통과 기준을 확인: 응답 시간(사용자의 관심사), 처리량(비즈니스적 관심사), 자원 사용량(시스템 관심사) 등의 기준 확인
- 테스트 계획 수립: 시나리오를 설정하고, 테스트 데이터를 설정하는 등의 준비 과정
- 테스트 환경 구성: 위에서 확인했던 테스트의 실제 환경을 구성하는 과정
- 테스트 시행: 테스트를 실제 시행하고, 결과를 모으는 과정.
- 결과 분석, 리포트 작성, 재테스트

##### 성능 테스팅의 이유: 서비스의 예상 퍼포먼스에 대해 알려주기 때문에 실제 서비스를 배포하기 전 중요한 지표가 될 수 있다.
 - 병목 현상을 찾아낼 수 있다.
 - 확장성 또는 안정성 이슈를 테스트함으로써 신뢰도 손상에 대한 예측을 할 수 있다.
 - 현재 서비의 인프라 적절성에 대해 판단할 수 있다.
 - 현재 버전의 소프트웨어와 배포하고자 하는 소프트웨어와의 성능 비교가 가능하다.
 - 소프트웨어의 성능 향상이 가능하다. (병목현상 발견 등)

##### 성능 테스팅 vs 성능 튜닝
- 성능 테스팅에서 문제를 파악한 뒤, 퍼포먼스의 심화적인 변경을 위해 성능 튜닝으로 넘어간다. 따라서 성능 테스팅은 튜닝을 가능하게 한다. 다양한 사람들`(DB, 시스템, 네트워크 관리자 등)`과 협업을 통해 테스팅에서 발견한 문제를 해결할 수 있다.
- 튜닝이 끝난 후 테스팅을 다시 진행해서 문제가 해결되었는지 확인해야 한다.

##### 베이스라인 세우기
- 베이스라인은 다양한 레이어에서 세워져야 한다.(어플리케이션, 컴포넌트, 시스템 등)
- 베이스라인은 성능 변화를 잘 감지할 수 있도록 해준다.
- 베이스라인은 서비스의 성장에 따라 함께 변화해야 한다.

##### 용어 정리
- 용량 테스트
- 컴포넌트 테스트: 서버, DB, 네트워크, 방화벽, 스토리지 등의 테스트
- 내구성 테스트: load testing 과 비슷하다. 서비스에서 많은 양의 처리가 가능한지 알아보는 테스트
- 성능 테스트: 서비스의 속도, 확장성, 안정성 등의 특성을 확인하는 테스트로, 가장 큰 범위의 테스트
- 대기 시간: 요청 시작부터 완료까지 걸리는 시간
- 스모크 테스트: 정상적인 로드에서 서비스가 가능한지 확인하는 테스트
- 포화상태`(saturation)`: 자원이 완전히 활용 된 시점을 뜻한다.
- 스파이크 테스트: 단기간동안 반복적으로 증가하는 로드에 대한 테스트(스트레스 테스트의 하위 집합)
- 시나리오: 어플리케이션 실행의 단계를 뜻한다. 유스케이스나 비즈니스 로직을 나타낼 수 있다.
- 스트레스 테스트: 최대 수용 로드를 초과하였을 때 서비스의 동작을 평가하기 위한 테스트. 이 테스트는 __높은 부하 조건에서만 나타나는 어플리케이션의 버그를 찾아내기 위해__ 시행된다.
- 단위 테스트
- 유효성 테스트: 서비스의 속도, 확장성, 안정성 등을 사전에 설정한 기대치와 부합하는지 비교하는 테스트

### Chapter 2 - Types of Performance Testing

#### 성능 테스트
- 스피드, 확장가능성, 안정성을 측정하기 위한 테스트
- 이 챕터에서 소개하는 테스트 중 가장 큰 범위의 테스트로, 서비스에 대한 포괄적인 검증을 한다.
- 튜닝, 용량 계획등의 최적화 작업을 할 때 쓰인다.
- 사용자의 입장에서 성능 특정에 만족하는 지를 판단하는 데에 중점을 둔다.
- 필요 상황: 크고 작은 모든 서비스를 배포하기 전에 꼭 거쳐야 할 __필수적인 테스트__ 이다.

#### 로드 테스트
- 정상적인 조건에서 서비스가 어떻게 동작하는지 확인하는 테스트
- 응답 시간, 처리 속도 등을 측정하고, 프로그램의 중단 점을 식별할 수 있다.
- 어플리케이션이 기본적으로 동작해야 할 기능들을 정확히 동작하는지를 알아보는 테스트이다.
- 하드웨어 환경의 적합성을 판단하고, 로드밸런서의 적합성을 평가한다.
- 내구성 테스트(endurance test)는 로드 테스트 하위의 테스트로, 예상된 부하량에서 어플리케이션이 어떻게 동작하는지 확인하는 테스트이다.
- 필요 상황: 주로 비즈니스적인 상황에서 요구사항을 충족했는지 확인할 상황에 필요하다.

#### 스트레스 테스트
- 어플리케이션이 견딜 수 있는 것보다 더 많은 푸시가 들어왔을 때 어떻게 반응하는지 알기 위한 테스트이다.
- 대부분의 어플리케이션에서, 갑자기 많은 양의 요청이 들어올 때에 알 수 없는 에러가 발생하기 때문에 이를 해결하기 위한 테스트이다.
- 시스템
- 필요 상황: 사용자(또는 트랜잭션이) 갑자기 늘어날 수 있는 어플리케이션(수강신청 서버, 한정 세일때의 온라인 마켓 등)에서 필수적으로 거쳐야 할 테스트이다.

#### 수용량(Capacity) 테스트
- 서비스가 얼마나 많은 사용자/트랜잭션을 수용할 수 있는지 측정하는 테스트이다.
- 필요 상황: 점차적으로 스케일 업을 계획하고 있는 시스템에서 필요하다. 스케일 업을 할 경우에 얼마나 많은 네트워크, 메모리 그리고 스토리지를 준비해야 하는 지 알아야 한다.

#### 컴포넌트 테스트
- 서버, DB, 네트워크, 방화벽, 스토리지 등의 서비스가 제대로 동작하는지 파악하는 테스트
- 필요 상황: 많은 수의 컴포넌트를 사용할 때, 제대로 최적화가 되었는지 확인하는 과정이 필요하다.

#### 조사 테스트
- 정의한 가설에 대해 입증하거나 반증하기 위해 자주 사용된다.
- 필요 상황: 어떠한 버그가 계속해서 발생할 때에 이 버그에 대한 이유를 분석하여 정의를 세우고, 이를 확인하기 위한 작업을 할 때 사용된다.

#### 스모크 테스트
- 정상적인 로드에서 서비스가 가능한지 확인하는 테스트
- 필요 상황: 성능 테스트의 초기에 먼저 시행해야 한다. 만약 이 테스트를 통과하지 못하였다면 오류를 해결 한 후 다시 테스트를 진행해야 할 것이다.

#### 단위 테스트
- 위의 테스트와 달리 직접 코드를 보며 검증하는 테스트이다. 직접 테스트를 작성한 개발자가 자주 작성하고 수행한다.
- 함수, 프로시저, 메서드, 클래스를 기준으로 테스트를 진행한다.
- 필요 상황: 결과를 예상할 수 있는 개발 환경에서, 개발자가 미리 원하는 예상 결과를 정해 놓고 이에 맞게 코드를 개발하려 할 때 필요할 수 있다.

#### 유효성 검사 테스트
- 정해진 기대치와 개발된 서비스가 일치하는지 확인하는 테스트이다.
- 필요 상황: 비즈니스적인 상황에서 요구사항을 충족했는지 확인할 상황에 필요하다.


### Chapter 3 - Risks Addressed Through Performance testing

#### 성능 테스트 요소
- 수용량 - 정상적인 상태 혹은 과부하 상태에서 시스템 용량이 충분한지
- 컴포넌트 - 각 컴포넌트들(DB, 네트워크, 스토리지 등)이 자기 역할을 잘 하고 있는지, 시스템에 최적화 되어 있는지, 성능 이슈가 이 컴포넌트로 인해 발생하는지
- 내구성 - 시간이 지나도 항상 같은 성능을 유지하는지, 외부에서 성능을 저하하는 요소가 발생되는지
- 조사: 시간이 경과할 수록 어떤 성능을 내고 있는지
- 로드: 에러가 발생하기 전에 어플리케이션이 수용할 수 있는 사용자 수는 몇명인지, DB나 파일 서버에서 처리할 수 있는 데이터의 양은 어느 정도인지, 네트워크의 구성 요소가 적절한지
- 스모크: 다음에 어떤 유형의 성능 테스트를 수행해야 하는지, 해당 빌드가 마지막 테스트와 비교했을 때 어떤 결과인지
- 스파이크: 예상했던 부하보다 초과된 부하가 생긴다면 어떻게 되는지, 어떤 종류의 실패에 대한 계획을 해야 하는지
- 스트레스: 실패 이전에 이를 해결하기 위해서 어떤 지표를 찾으면 알 수 있는지
- 단위: 효율적인 코드인지, 의도한 대로 동작하는 코드인지
- 적합성: 해당 서비스가 요구사항에 잘 맞게 동작하는지, 원하는 결과와 같은지, 해당 버전이 마지막 테스트와 비교했을 때 어떤 결과인지

#### 속도와 관련된 위험
속도에 대한 이슈는 최종 사용도의 만족도에 필수적인 항목이다. 이것 뿐만 아니라 특정 비즈니스 및 데이터에 관련해서도 중요한 문제이다.
- 서비스는 사용자가 만족할 정도로 충분히 빠른지?
- 데이터의 만기 기한 이내에 처리할 수 있는지?
- 사용자에게 최신 데이터를 보여줄 수 있는지?
- 최대 응답 시간 이전에 웹 서비스가 응답하는지?

##### 이를 해결하기 위한 테스팅 방법
- 다른 어플리케이션과 속도 측정을 비교하자
- 실제 비즈니스에서 사용되는 것과 유사한 데이터 유형으로 테스트를 수행하고, 비슷한 정보를 데이터베이스에 미리 추가해놓자
- 성능 테스트 시나리오에 시간이 중요한 트랜잭션을 추가하자
- 다양한 조건과 부하가 섞인 시나리오에서 속도를 측정해보자
- 성능 테스트 중에 모든 데이터가 표시되고 저장되었는지 확인하자. (트랜잭션 관련 문제)

#### 확장성과 관련된 위험들
확장성 위험은 __서비스가 얼마나 많은 사용자를 수용할 수 있는지__ 뿐만 아니라 __서비스가 감당할 수 있는 데이터의 양__ 과 관련되어 있다.
- 서비스가 어떤 사용자 계층이던지 일관되고 수용 가능한 응답 시간을 제공하는지?
- 어플리케이션이 서비스를 제공하는 중 만들어지는 모든 데이터를 저장할 수 있는지?
- 용량이 한계치에 다다랐을 때 서비스가 경고를 알려주는지?
- 과부하가 일어났을 때에도 보안이 유지되는지?
- 과부하가 일어났을 때 올바른 기능을 할 수 있는 지?
- 어플리케이션이 견딜 수 없는 부하를 일으켰을 때 견딜 수 있는지?

##### 이를 해결하기 위한 테스팅 방법
- 다양한 부하에서 측정된 속도를 비교하자
- 실제 비즈니스에서 사용되는 것과 유사한 데이터 유형으로 테스트를 수행하고, 비슷한 정보를 데이터베이스에 미리 추가해놓자
- 확장성의 한계를 찾아서 어플리케이션이 재시작 할 수 있는 시간을 만들어주는 메트릭을 추가하자
- 실제 요구 사항에 매핑되는 의미있는 성능 테스트를 수행하자
- 정상 및 피크 시간에 실제 워크로드를 복사하는 로드 테스트를 설계하자

#### 안전성과 관련된 위험들
안전성은 신뢰성, 가동 시간 및 복구 가능성과 같은 영역을 포괄하는 용어이다.
- 데이터 손상, 속도 저하 등의 에러 없이 오랜 시간 동안 어플리케이션을 실행할 수 있는지?
- 부분적으로 완료된 트랜잭션이 있다면 어떻게 되는지(롤백을 하는지?)
- 시스템을 패치하지 않고 업데이트 할 수 있는지?
- 중첩된 오류의 조합으로 시스템 충돌이 발생할 가능성이 있는지?
- 시스템이 중단 된 이후에 다시 정상적인 작동을 할 때, 사용자는 일어난 문제를 모두 파악할 수 있는지?

##### 이를 해결하기 위한 테스팅 방법
- 테스트 중에 서버를 오프라인으로 돌리고, 이 때 발생하는 시스템의 기능과 무결성을 확인하자
- 시스템 재부팅 직전과 직후 동일한 테스트를 진행하고 결과를 비교하자
- 성능 테스트 시나리오에 오류와 예외 사례를 포함시키자
- 성능 테스트 중에 시스템에 패치를 적용해보자
- 성능 테스트 중에 백업을 강제 실행해보자
